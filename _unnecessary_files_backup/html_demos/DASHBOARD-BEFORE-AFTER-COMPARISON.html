<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDN AI Dashboard - Before/After Code Comparison</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .stat-card h3 {
            color: #8b949e;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-card .subtitle {
            color: #6e7681;
            font-size: 0.875rem;
        }

        .stat-card.failures .value { color: #f85149; }
        .stat-card.analyzed .value { color: #3fb950; }
        .stat-card.confidence .value { color: #58a6ff; }
        .stat-card.aging .value { color: #d29922; }

        .section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #c9d1d9;
            border-bottom: 1px solid #30363d;
            padding-bottom: 0.5rem;
        }

        .failure-card {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .failure-card:hover {
            border-color: #667eea;
            box-shadow: 0 0 0 1px #667eea;
        }

        .failure-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .failure-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .failure-id {
            font-weight: 700;
            color: #58a6ff;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge.aging-high { background: rgba(248, 81, 73, 0.1); color: #f85149; border: 1px solid rgba(248, 81, 73, 0.3); }
        .badge.aging-medium { background: rgba(210, 153, 34, 0.1); color: #d29922; border: 1px solid rgba(210, 153, 34, 0.3); }
        .badge.aging-low { background: rgba(110, 118, 129, 0.1); color: #8b949e; border: 1px solid rgba(110, 118, 129, 0.3); }

        .badge.code-error { background: rgba(88, 166, 255, 0.1); color: #58a6ff; border: 1px solid rgba(88, 166, 255, 0.3); }
        .badge.test-failure { background: rgba(248, 81, 160, 0.1); color: #f85190; border: 1px solid rgba(248, 81, 160, 0.3); }
        .badge.config-error { background: rgba(187, 128, 9, 0.1); color: #bb8009; border: 1px solid rgba(187, 128, 9, 0.3); }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #238636;
            color: white;
        }

        .btn-primary:hover {
            background: #2ea043;
        }

        .btn-analyze {
            background: #1f6feb;
            color: white;
        }

        .btn-analyze:hover {
            background: #388bfd;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: flex-start;
            justify-content: center;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 12px;
            max-width: 1600px;
            width: 100%;
            margin: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .modal-close:hover {
            background: rgba(255,255,255,0.2);
        }

        /* BEFORE/AFTER SPLIT VIEW */
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            margin: 2rem;
            border: 1px solid #30363d;
            border-radius: 8px;
            overflow: hidden;
        }

        .comparison-side {
            padding: 1.5rem;
            position: relative;
        }

        .comparison-side.before {
            background: #1a0f0f;
            border-right: 2px solid #f85149;
        }

        .comparison-side.after {
            background: #0f1a0f;
        }

        .comparison-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #30363d;
        }

        .comparison-header .icon {
            font-size: 1.5rem;
        }

        .comparison-header h3 {
            font-size: 1.125rem;
            margin: 0;
        }

        .comparison-side.before .comparison-header h3 {
            color: #f85149;
        }

        .comparison-side.after .comparison-header h3 {
            color: #3fb950;
        }

        .file-path {
            background: rgba(110, 118, 129, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            color: #8b949e;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-path .line-number {
            color: #58a6ff;
            font-weight: 600;
        }

        .code-block {
            background: #010409;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            line-height: 1.6;
        }

        .code-line {
            display: flex;
            padding: 0.125rem 0;
        }

        .code-line-number {
            width: 40px;
            text-align: right;
            color: #6e7681;
            user-select: none;
            padding-right: 1rem;
            flex-shrink: 0;
        }

        .code-content {
            flex: 1;
            white-space: pre;
        }

        /* ERROR LINES */
        .code-line.error {
            background: rgba(248, 81, 73, 0.1);
            border-left: 3px solid #f85149;
            padding-left: 0.5rem;
        }

        .code-line.error .code-content {
            color: #f85149;
        }

        /* FIXED LINES */
        .code-line.added {
            background: rgba(63, 185, 80, 0.1);
            border-left: 3px solid #3fb950;
            padding-left: 0.5rem;
        }

        .code-line.added .code-content {
            color: #3fb950;
        }

        .code-line.added .code-content::before {
            content: '+ ';
            color: #3fb950;
            font-weight: 700;
        }

        .code-line.removed {
            background: rgba(248, 81, 73, 0.05);
            border-left: 3px solid #6e7681;
            padding-left: 0.5rem;
            opacity: 0.6;
        }

        .code-line.removed .code-content::before {
            content: '- ';
            color: #6e7681;
        }

        .error-annotation {
            background: rgba(248, 81, 73, 0.1);
            border-left: 3px solid #f85149;
            padding: 1rem;
            margin-top: 0.5rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .error-annotation strong {
            color: #f85149;
        }

        .fix-annotation {
            background: rgba(63, 185, 80, 0.1);
            border-left: 3px solid #3fb950;
            padding: 1rem;
            margin-top: 0.5rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .fix-annotation strong {
            color: #3fb950;
        }

        .explanation {
            margin: 1.5rem 2rem;
            padding: 1.5rem;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
        }

        .explanation h4 {
            color: #58a6ff;
            margin-bottom: 1rem;
        }

        .explanation ul {
            margin-left: 1.5rem;
        }

        .explanation li {
            margin-bottom: 0.5rem;
        }

        .github-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #58a6ff;
            text-decoration: none;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .github-link:hover {
            background: #30363d;
            border-color: #58a6ff;
        }

        .actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 2rem;
            padding: 1rem;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.5rem 2rem;
        }

        .metadata-item {
            text-align: center;
            padding: 1rem;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
        }

        .metadata-label {
            font-size: 0.75rem;
            color: #8b949e;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        .metadata-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid;
        }

        .alert-info {
            background: rgba(56, 139, 253, 0.1);
            color: #58a6ff;
            border-color: rgba(56, 139, 253, 0.3);
        }

        /* Analytics Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .chart-card h3 {
            color: #c9d1d9;
            font-size: 1.125rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #30363d;
            padding-bottom: 0.5rem;
        }

        .chart-placeholder {
            background: #0d1117;
            border: 1px dashed #30363d;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            color: #6e7681;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .kpi-card .label {
            font-size: 0.75rem;
            color: #8b949e;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .kpi-card .value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .kpi-card .change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .kpi-card .change.positive {
            color: #3fb950;
        }

        .kpi-card .change.negative {
            color: #f85149;
        }

        .workflow-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .workflow-stat {
            background: #0d1117;
            border: 1px solid #30363d;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .workflow-stat .count {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .workflow-stat .label {
            font-size: 0.875rem;
            color: #8b949e;
        }

        .trend-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .trend-table th {
            background: #0d1117;
            padding: 0.75rem;
            text-align: left;
            color: #8b949e;
            border-bottom: 1px solid #30363d;
        }

        .trend-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #21262d;
        }

        .trend-table tr:hover {
            background: #0d1117;
        }

        .sparkline {
            display: inline-flex;
            gap: 2px;
            align-items: flex-end;
            height: 20px;
        }

        .sparkline-bar {
            width: 3px;
            background: #58a6ff;
            border-radius: 1px;
        }

        .tab-container {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .tab-header {
            display: flex;
            border-bottom: 1px solid #30363d;
        }

        .tab-button {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            color: #8b949e;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .tab-button:hover {
            background: #21262d;
            color: #c9d1d9;
        }

        .tab-button.active {
            color: #58a6ff;
            border-bottom: 2px solid #58a6ff;
        }

        .tab-content {
            padding: 2rem;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ðŸ¤– DDN AI Test Failure Analysis Dashboard</h1>
            <p>AI-powered root cause detection with before/after code comparison</p>
        </div>
    </div>

    <div class="container">
        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card failures">
                <h3>Total Failures</h3>
                <div class="value">127</div>
                <div class="subtitle">Last 7 days</div>
            </div>
            <div class="stat-card analyzed">
                <h3>Analyzed</h3>
                <div class="value">94</div>
                <div class="subtitle">74% coverage</div>
            </div>
            <div class="stat-card confidence">
                <h3>Avg Confidence</h3>
                <div class="value">87%</div>
                <div class="subtitle">AI accuracy</div>
            </div>
            <div class="stat-card aging">
                <h3>Avg Aging</h3>
                <div class="value">3.2d</div>
                <div class="subtitle">Time to resolution</div>
            </div>
        </div>

        <!-- Alert -->
        <div class="alert alert-info">
            <strong>ðŸ”´ Live Status (Last 24h):</strong> 15 new failures, 12 analyzed, 8 resolved â€¢ Latest: DDN-Integration-Tests (CODE_ERROR) 2 min ago
        </div>

        <!-- ANALYTICS TABS -->
        <div class="tab-container">
            <div class="tab-header">
                <button class="tab-button active" onclick="switchTab('failures')">Failures List</button>
                <button class="tab-button" onclick="switchTab('workflows')">Workflow Analytics</button>
                <button class="tab-button" onclick="switchTab('trends')">Error Trends</button>
                <button class="tab-button" onclick="switchTab('kpis')">KPIs & Metrics</button>
            </div>
            <div class="tab-content">
                <!-- TAB 1: FAILURES LIST -->
                <div id="tab-failures" class="tab-pane active">
                    <div class="section">
                        <h2>Recent Test Failures</h2>

                        <div class="failure-card" onclick="openComparison('12345')">
                            <div class="failure-header">
                                <div class="failure-title">
                                    <span class="failure-id">#12345</span>
                                    <span>DDN-Smoke-Tests</span>
                                    <span class="badge code-error">CODE_ERROR</span>
                                    <span class="badge aging-high">7 days</span>
                                </div>
                                <button class="btn btn-primary">View Before/After â†’</button>
                            </div>
                            <div style="color: #8b949e; font-size: 0.875rem;">
                                <strong style="color: #f85149;">Error:</strong> NullPointerException at DDNStorage.java:127<br>
                                <strong style="color: #3fb950;">Fix:</strong> Add null check before accessing storageConfig object
                            </div>
                        </div>

                        <div class="failure-card" onclick="openComparison('12346')">
                            <div class="failure-header">
                                <div class="failure-title">
                                    <span class="failure-id">#12346</span>
                                    <span>DDN-Integration-Tests</span>
                                    <span class="badge test-failure">TEST_FAILURE</span>
                                    <span class="badge aging-medium">3 days</span>
                                </div>
                                <button class="btn btn-analyze">Analyze Now</button>
                            </div>
                            <div style="color: #8b949e; font-size: 0.875rem;">
                                <strong style="color: #f85149;">Error:</strong> AssertionError: Expected 200, got 500<br>
                                <strong style="color: #6e7681;">Status:</strong> Not analyzed yet
                            </div>
                        </div>

                        <div class="failure-card" onclick="openComparison('12347')">
                            <div class="failure-header">
                                <div class="failure-title">
                                    <span class="failure-id">#12347</span>
                                    <span>DDN-Config-Tests</span>
                                    <span class="badge config-error">CONFIG_ERROR</span>
                                    <span class="badge aging-low">1 day</span>
                                </div>
                                <button class="btn btn-primary">View Before/After â†’</button>
                            </div>
                            <div style="color: #8b949e; font-size: 0.875rem;">
                                <strong style="color: #f85149;">Error:</strong> Missing storage.path property in app.properties<br>
                                <strong style="color: #3fb950;">Fix:</strong> Add storage.path=/var/lib/ddn/storage to config
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 2: WORKFLOW ANALYTICS -->
                <div id="tab-workflows" class="tab-pane">
                    <h2 style="margin-bottom: 1.5rem;">n8n Workflow Execution Analytics</h2>

                    <!-- Workflow Stats -->
                    <div class="workflow-stats">
                        <div class="workflow-stat">
                            <div class="count" style="color: #58a6ff;">342</div>
                            <div class="label">Total Executions (7d)</div>
                        </div>
                        <div class="workflow-stat">
                            <div class="count" style="color: #3fb950;">298</div>
                            <div class="label">Successful (87%)</div>
                        </div>
                        <div class="workflow-stat">
                            <div class="count" style="color: #f85149;">44</div>
                            <div class="label">Failed (13%)</div>
                        </div>
                    </div>

                    <!-- Day-wise Executions -->
                    <div class="chart-card" style="margin-bottom: 1.5rem;">
                        <h3>ðŸ“Š Daily Workflow Executions (Last 7 Days)</h3>
                        <table class="trend-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Workflow 1 (Auto)</th>
                                    <th>Workflow 2 (Manual)</th>
                                    <th>Workflow 3 (Refine)</th>
                                    <th>Total</th>
                                    <th>Success Rate</th>
                                    <th>Trend</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>2025-10-18</strong> (Today)</td>
                                    <td style="color: #58a6ff;">12</td>
                                    <td style="color: #d29922;">28</td>
                                    <td style="color: #bb8009;">8</td>
                                    <td><strong>48</strong></td>
                                    <td style="color: #3fb950;">89%</td>
                                    <td><div class="sparkline">
                                        <div class="sparkline-bar" style="height: 60%;"></div>
                                        <div class="sparkline-bar" style="height: 80%;"></div>
                                        <div class="sparkline-bar" style="height: 100%;"></div>
                                    </div></td>
                                </tr>
                                <tr>
                                    <td>2025-10-17</td>
                                    <td style="color: #58a6ff;">15</td>
                                    <td style="color: #d29922;">32</td>
                                    <td style="color: #bb8009;">5</td>
                                    <td><strong>52</strong></td>
                                    <td style="color: #3fb950;">92%</td>
                                    <td><div class="sparkline">
                                        <div class="sparkline-bar" style="height: 70%;"></div>
                                        <div class="sparkline-bar" style="height: 90%;"></div>
                                        <div class="sparkline-bar" style="height: 95%;"></div>
                                    </div></td>
                                </tr>
                                <tr>
                                    <td>2025-10-16</td>
                                    <td style="color: #58a6ff;">18</td>
                                    <td style="color: #d29922;">25</td>
                                    <td style="color: #bb8009;">6</td>
                                    <td><strong>49</strong></td>
                                    <td style="color: #3fb950;">86%</td>
                                    <td><div class="sparkline">
                                        <div class="sparkline-bar" style="height: 80%;"></div>
                                        <div class="sparkline-bar" style="height: 75%;"></div>
                                        <div class="sparkline-bar" style="height: 85%;"></div>
                                    </div></td>
                                </tr>
                                <tr>
                                    <td>2025-10-15</td>
                                    <td style="color: #58a6ff;">10</td>
                                    <td style="color: #d29922;">22</td>
                                    <td style="color: #bb8009;">4</td>
                                    <td><strong>36</strong></td>
                                    <td style="color: #3fb950;">91%</td>
                                    <td><div class="sparkline">
                                        <div class="sparkline-bar" style="height: 50%;"></div>
                                        <div class="sparkline-bar" style="height: 70%;"></div>
                                        <div class="sparkline-bar" style="height: 60%;"></div>
                                    </div></td>
                                </tr>
                                <tr>
                                    <td>2025-10-14</td>
                                    <td style="color: #58a6ff;">22</td>
                                    <td style="color: #d29922;">35</td>
                                    <td style="color: #bb8009;">9</td>
                                    <td><strong>66</strong></td>
                                    <td style="color: #3fb950;">88%</td>
                                    <td><div class="sparkline">
                                        <div class="sparkline-bar" style="height: 90%;"></div>
                                        <div class="sparkline-bar" style="height: 95%;"></div>
                                        <div class="sparkline-bar" style="height: 100%;"></div>
                                    </div></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Workflow Details -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>ðŸ”„ Workflow 1 - Auto Trigger</h3>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Total Executions:</span>
                                    <strong style="color: #58a6ff;">77</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Avg Duration:</span>
                                    <strong>14.2s</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Success Rate:</span>
                                    <strong style="color: #3fb950;">91%</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #8b949e;">Avg Cost:</span>
                                    <strong style="color: #d29922;">$0.06</strong>
                                </div>
                            </div>
                            <div style="font-size: 0.875rem; color: #6e7681;">
                                Triggered by Jenkins webhook when build aging >= 5 days
                            </div>
                        </div>

                        <div class="chart-card">
                            <h3>ðŸ‘† Workflow 2 - Manual Trigger</h3>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Total Executions:</span>
                                    <strong style="color: #d29922;">142</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Avg Duration:</span>
                                    <strong>12.8s</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Success Rate:</span>
                                    <strong style="color: #3fb950;">94%</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #8b949e;">Avg Cost:</span>
                                    <strong style="color: #d29922;">$0.05</strong>
                                </div>
                            </div>
                            <div style="font-size: 0.875rem; color: #6e7681;">
                                User-initiated from dashboard "Analyze Now" button
                            </div>
                        </div>

                        <div class="chart-card">
                            <h3>ðŸ’¬ Workflow 3 - Refinement</h3>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Total Executions:</span>
                                    <strong style="color: #bb8009;">32</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Avg Duration:</span>
                                    <strong>18.5s</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Success Rate:</span>
                                    <strong style="color: #3fb950;">97%</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #8b949e;">Avg Cost:</span>
                                    <strong style="color: #d29922;">$0.11</strong>
                                </div>
                            </div>
                            <div style="font-size: 0.875rem; color: #6e7681;">
                                User feedback-driven re-analysis (always uses MCP)
                            </div>
                        </div>

                        <div class="chart-card">
                            <h3>ðŸ“ˆ Cost Optimization</h3>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">Total Cost (7d):</span>
                                    <strong style="color: #d29922;">$18.45</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">RAG Usage:</span>
                                    <strong style="color: #3fb950;">82%</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span style="color: #8b949e;">MCP Usage:</span>
                                    <strong style="color: #58a6ff;">18%</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #8b949e;">Savings vs Full MCP:</span>
                                    <strong style="color: #3fb950;">$73.20 (80%)</strong>
                                </div>
                            </div>
                            <div style="font-size: 0.875rem; color: #6e7681;">
                                Smart routing: 82% use RAG ($0.01), 18% use MCP ($0.08)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 3: ERROR TRENDS -->
                <div id="tab-trends" class="tab-pane">
                    <h2 style="margin-bottom: 1.5rem;">Error Trend Analysis (MongoDB Data)</h2>

                    <!-- Category Breakdown -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>ðŸ“Š Error Category Distribution</h3>
                            <table class="trend-table">
                                <thead>
                                    <tr>
                                        <th>Category</th>
                                        <th>Count</th>
                                        <th>%</th>
                                        <th>Trend</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="badge code-error">CODE_ERROR</span></td>
                                        <td><strong>54</strong></td>
                                        <td>42.5%</td>
                                        <td style="color: #f85149;">â†‘ +12%</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge test-failure">TEST_FAILURE</span></td>
                                        <td><strong>38</strong></td>
                                        <td>29.9%</td>
                                        <td style="color: #3fb950;">â†“ -5%</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge config-error">CONFIG_ERROR</span></td>
                                        <td><strong>22</strong></td>
                                        <td>17.3%</td>
                                        <td style="color: #3fb950;">â†“ -8%</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge" style="background: rgba(187, 128, 9, 0.1); color: #bb8009; border: 1px solid rgba(187, 128, 9, 0.3);">INFRA_ERROR</span></td>
                                        <td><strong>13</strong></td>
                                        <td>10.2%</td>
                                        <td style="color: #8b949e;">â†’ 0%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="chart-card">
                            <h3>ðŸŽ¯ Most Common Error Patterns</h3>
                            <table class="trend-table">
                                <thead>
                                    <tr>
                                        <th>Error Pattern</th>
                                        <th>Occurrences</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>NullPointerException</td>
                                        <td><strong style="color: #f85149;">28</strong></td>
                                    </tr>
                                    <tr>
                                        <td>AssertionError</td>
                                        <td><strong style="color: #f85149;">19</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Connection Timeout</td>
                                        <td><strong style="color: #d29922;">15</strong></td>
                                    </tr>
                                    <tr>
                                        <td>ClassCastException</td>
                                        <td><strong style="color: #d29922;">12</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Missing Configuration</td>
                                        <td><strong style="color: #bb8009;">8</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Time-based Analysis -->
                    <div class="chart-card" style="margin-top: 1.5rem;">
                        <h3>ðŸ“… Error Trend (Last 7 Days)</h3>
                        <table class="trend-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>CODE_ERROR</th>
                                    <th>TEST_FAILURE</th>
                                    <th>CONFIG_ERROR</th>
                                    <th>INFRA_ERROR</th>
                                    <th>Total</th>
                                    <th>Analysis Coverage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>2025-10-18</strong></td>
                                    <td style="color: #58a6ff;">8</td>
                                    <td style="color: #f85190;">5</td>
                                    <td style="color: #bb8009;">3</td>
                                    <td style="color: #d29922;">2</td>
                                    <td><strong>18</strong></td>
                                    <td style="color: #3fb950;">83%</td>
                                </tr>
                                <tr>
                                    <td>2025-10-17</td>
                                    <td style="color: #58a6ff;">7</td>
                                    <td style="color: #f85190;">6</td>
                                    <td style="color: #bb8009;">4</td>
                                    <td style="color: #d29922;">1</td>
                                    <td><strong>18</strong></td>
                                    <td style="color: #3fb950;">78%</td>
                                </tr>
                                <tr>
                                    <td>2025-10-16</td>
                                    <td style="color: #58a6ff;">9</td>
                                    <td style="color: #f85190;">4</td>
                                    <td style="color: #bb8009;">2</td>
                                    <td style="color: #d29922;">3</td>
                                    <td><strong>18</strong></td>
                                    <td style="color: #3fb950;">72%</td>
                                </tr>
                                <tr>
                                    <td>2025-10-15</td>
                                    <td style="color: #58a6ff;">6</td>
                                    <td style="color: #f85190;">7</td>
                                    <td style="color: #bb8009;">3</td>
                                    <td style="color: #d29922;">2</td>
                                    <td><strong>18</strong></td>
                                    <td style="color: #3fb950;">67%</td>
                                </tr>
                                <tr>
                                    <td>2025-10-14</td>
                                    <td style="color: #58a6ff;">10</td>
                                    <td style="color: #f85190;">8</td>
                                    <td style="color: #bb8009;">5</td>
                                    <td style="color: #d29922;">0</td>
                                    <td><strong>23</strong></td>
                                    <td style="color: #3fb950;">74%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- TAB 4: KPIs & METRICS -->
                <div id="tab-kpis" class="tab-pane">
                    <h2 style="margin-bottom: 1.5rem;">Key Performance Indicators</h2>

                    <!-- Primary KPIs -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="label">Analysis Success Rate</div>
                            <div class="value" style="color: #3fb950;">89%</div>
                            <div class="change positive">â†‘ +4% vs last week</div>
                        </div>
                        <div class="kpi-card">
                            <div class="label">Avg Confidence Score</div>
                            <div class="value" style="color: #58a6ff;">87%</div>
                            <div class="change positive">â†‘ +2% vs last week</div>
                        </div>
                        <div class="kpi-card">
                            <div class="label">Avg Resolution Time</div>
                            <div class="value" style="color: #d29922;">3.2d</div>
                            <div class="change positive">â†“ -0.8d vs last week</div>
                        </div>
                        <div class="kpi-card">
                            <div class="label">Cost per Analysis</div>
                            <div class="value" style="color: #d29922;">$0.06</div>
                            <div class="change positive">â†“ -$0.02 vs last week</div>
                        </div>
                        <div class="kpi-card">
                            <div class="label">RAG Hit Rate</div>
                            <div class="value" style="color: #3fb950;">82%</div>
                            <div class="change positive">â†‘ +7% vs last week</div>
                        </div>
                        <div class="kpi-card">
                            <div class="label">User Refinements</div>
                            <div class="value" style="color: #bb8009;">32</div>
                            <div class="change negative">â†‘ +5 vs last week</div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>âš¡ Performance Metrics</h3>
                            <table class="trend-table">
                                <thead>
                                    <tr>
                                        <th>Metric</th>
                                        <th>Value</th>
                                        <th>Target</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Avg Analysis Time</td>
                                        <td><strong>13.8s</strong></td>
                                        <td>&lt; 20s</td>
                                        <td style="color: #3fb950;">âœ… Pass</td>
                                    </tr>
                                    <tr>
                                        <td>RAG Response Time</td>
                                        <td><strong>5.2s</strong></td>
                                        <td>&lt; 10s</td>
                                        <td style="color: #3fb950;">âœ… Pass</td>
                                    </tr>
                                    <tr>
                                        <td>MCP Response Time</td>
                                        <td><strong>15.3s</strong></td>
                                        <td>&lt; 30s</td>
                                        <td style="color: #3fb950;">âœ… Pass</td>
                                    </tr>
                                    <tr>
                                        <td>Error Coverage</td>
                                        <td><strong>74%</strong></td>
                                        <td>&gt; 70%</td>
                                        <td style="color: #3fb950;">âœ… Pass</td>
                                    </tr>
                                    <tr>
                                        <td>Workflow Uptime</td>
                                        <td><strong>99.2%</strong></td>
                                        <td>&gt; 99%</td>
                                        <td style="color: #3fb950;">âœ… Pass</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="chart-card">
                            <h3>ðŸ’° Cost Analysis</h3>
                            <table class="trend-table">
                                <thead>
                                    <tr>
                                        <th>Cost Type</th>
                                        <th>7 Days</th>
                                        <th>Monthly Estimate</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Claude API (Anthropic)</td>
                                        <td><strong>$12.34</strong></td>
                                        <td>$52.89</td>
                                    </tr>
                                    <tr>
                                        <td>OpenAI Embeddings</td>
                                        <td><strong>$0.48</strong></td>
                                        <td>$2.06</td>
                                    </tr>
                                    <tr>
                                        <td>Pinecone Vector DB</td>
                                        <td><strong>$0.00</strong></td>
                                        <td>$0.00 (Free tier)</td>
                                    </tr>
                                    <tr>
                                        <td>MongoDB Atlas</td>
                                        <td><strong>$0.00</strong></td>
                                        <td>$0.00 (Free tier)</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total</strong></td>
                                        <td><strong style="color: #3fb950;">$12.82</strong></td>
                                        <td><strong>$54.95</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div style="margin-top: 1rem; font-size: 0.875rem; color: #6e7681;">
                                <strong style="color: #3fb950;">Savings:</strong> $310/month vs manual analysis (5h/week @ $75/h)
                            </div>
                        </div>
                    </div>

                    <!-- Aging Analysis -->
                    <div class="chart-card" style="margin-top: 1.5rem;">
                        <h3>â° Failure Aging Analysis</h3>
                        <table class="trend-table">
                            <thead>
                                <tr>
                                    <th>Aging Bucket</th>
                                    <th>Count</th>
                                    <th>Percentage</th>
                                    <th>Avg Time to Fix</th>
                                    <th>Priority</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge aging-high">&gt; 7 days</span></td>
                                    <td><strong style="color: #f85149;">18</strong></td>
                                    <td>14.2%</td>
                                    <td>12.5 days</td>
                                    <td style="color: #f85149;">ðŸ”´ Critical</td>
                                </tr>
                                <tr>
                                    <td><span class="badge aging-medium">3-7 days</span></td>
                                    <td><strong style="color: #d29922;">42</strong></td>
                                    <td>33.1%</td>
                                    <td>4.8 days</td>
                                    <td style="color: #d29922;">ðŸŸ¡ High</td>
                                </tr>
                                <tr>
                                    <td><span class="badge aging-low">&lt; 3 days</span></td>
                                    <td><strong style="color: #8b949e;">67</strong></td>
                                    <td>52.7%</td>
                                    <td>1.5 days</td>
                                    <td style="color: #3fb950;">ðŸŸ¢ Normal</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Failures List (kept for backward compatibility) -->
        <div class="section">
            <h2>Recent Test Failures</h2>

            <div class="failure-card" onclick="openComparison('12345')">
                <div class="failure-header">
                    <div class="failure-title">
                        <span class="failure-id">#12345</span>
                        <span>DDN-Smoke-Tests</span>
                        <span class="badge code-error">CODE_ERROR</span>
                        <span class="badge aging-high">7 days</span>
                    </div>
                    <button class="btn btn-primary">View Before/After â†’</button>
                </div>
                <div style="color: #8b949e; font-size: 0.875rem;">
                    <strong style="color: #f85149;">Error:</strong> NullPointerException at DDNStorage.java:127<br>
                    <strong style="color: #3fb950;">Fix:</strong> Add null check before accessing storageConfig object
                </div>
            </div>

            <div class="failure-card" onclick="openComparison('12346')">
                <div class="failure-header">
                    <div class="failure-title">
                        <span class="failure-id">#12346</span>
                        <span>DDN-Integration-Tests</span>
                        <span class="badge test-failure">TEST_FAILURE</span>
                        <span class="badge aging-medium">3 days</span>
                    </div>
                    <button class="btn btn-analyze">Analyze Now</button>
                </div>
                <div style="color: #8b949e; font-size: 0.875rem;">
                    <strong style="color: #f85149;">Error:</strong> AssertionError: Expected 200, got 500<br>
                    <strong style="color: #6e7681;">Status:</strong> Not analyzed yet
                </div>
            </div>

            <div class="failure-card" onclick="openComparison('12347')">
                <div class="failure-header">
                    <div class="failure-title">
                        <span class="failure-id">#12347</span>
                        <span>DDN-Config-Tests</span>
                        <span class="badge config-error">CONFIG_ERROR</span>
                        <span class="badge aging-low">1 day</span>
                    </div>
                    <button class="btn btn-primary">View Before/After â†’</button>
                </div>
                <div style="color: #8b949e; font-size: 0.875rem;">
                    <strong style="color: #f85149;">Error:</strong> Missing storage.path property in app.properties<br>
                    <strong style="color: #3fb950;">Fix:</strong> Add storage.path=/var/lib/ddn/storage to config
                </div>
            </div>
        </div>
    </div>

    <!-- BEFORE/AFTER COMPARISON MODAL -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ðŸ” Before/After Code Comparison - Build #12345</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>

            <!-- Metadata -->
            <div class="metadata-grid">
                <div class="metadata-item">
                    <div class="metadata-label">Error Category</div>
                    <div class="metadata-value" style="color: #58a6ff;">CODE_ERROR</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">AI Confidence</div>
                    <div class="metadata-value" style="color: #3fb950;">92%</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">Analysis Type</div>
                    <div class="metadata-value" style="color: #d29922;">MCP Deep</div>
                </div>
            </div>

            <!-- SIDE BY SIDE COMPARISON -->
            <div class="comparison-container">
                <!-- BEFORE (ERROR CODE) -->
                <div class="comparison-side before">
                    <div class="comparison-header">
                        <span class="icon">âŒ</span>
                        <h3>BEFORE - Error Code</h3>
                    </div>

                    <div class="file-path">
                        <span>src/main/java/DDNStorage.java</span>
                        <span class="line-number">Line 125-135</span>
                    </div>

                    <div class="code-block">
<div class="code-line"><span class="code-line-number">125</span><span class="code-content">public void saveDatabindFile(String data) {</span></div>
<div class="code-line"><span class="code-line-number">126</span><span class="code-content">    // Configuration not validated!</span></div>
<div class="code-line error"><span class="code-line-number">127</span><span class="code-content">    String path = storageConfig.getPath();</span></div>
<div class="code-line"><span class="code-line-number">128</span><span class="code-content">    File file = new File(path, "databind.json");</span></div>
<div class="code-line"><span class="code-line-number">129</span><span class="code-content">    Files.write(file.toPath(), data.getBytes());</span></div>
<div class="code-line"><span class="code-line-number">130</span><span class="code-content">}</span></div>
                    </div>

                    <div class="error-annotation">
                        <strong>âš ï¸ Error Details:</strong><br>
                        <code>java.lang.NullPointerException</code><br>
                        at DDNStorage.saveDatabindFile(DDNStorage.java:127)<br><br>
                        <strong>Root Cause:</strong> The <code>storageConfig</code> object is accessed without null validation. When initialization fails, this causes NPE.
                    </div>
                </div>

                <!-- AFTER (FIXED CODE) -->
                <div class="comparison-side after">
                    <div class="comparison-header">
                        <span class="icon">âœ…</span>
                        <h3>AFTER - Recommended Fix</h3>
                    </div>

                    <div class="file-path">
                        <span>src/main/java/DDNStorage.java</span>
                        <span class="line-number">Line 125-138</span>
                    </div>

                    <div class="code-block">
<div class="code-line"><span class="code-line-number">125</span><span class="code-content">public void saveDatabindFile(String data) {</span></div>
<div class="code-line added"><span class="code-line-number">126</span><span class="code-content">if (storageConfig == null) {</span></div>
<div class="code-line added"><span class="code-line-number">127</span><span class="code-content">    throw new IllegalStateException(</span></div>
<div class="code-line added"><span class="code-line-number">128</span><span class="code-content">        "Storage not initialized. Call init() first."</span></div>
<div class="code-line added"><span class="code-line-number">129</span><span class="code-content">    );</span></div>
<div class="code-line added"><span class="code-line-number">130</span><span class="code-content">}</span></div>
<div class="code-line added"><span class="code-line-number">131</span><span class="code-content"></span></div>
<div class="code-line"><span class="code-line-number">132</span><span class="code-content">    String path = storageConfig.getPath();</span></div>
<div class="code-line"><span class="code-line-number">133</span><span class="code-content">    File file = new File(path, "databind.json");</span></div>
<div class="code-line"><span class="code-line-number">134</span><span class="code-content">    Files.write(file.toPath(), data.getBytes());</span></div>
<div class="code-line"><span class="code-line-number">135</span><span class="code-content">}</span></div>
                    </div>

                    <div class="fix-annotation">
                        <strong>âœ… Fix Applied:</strong><br>
                        1. Added null check before accessing <code>storageConfig</code><br>
                        2. Throws <code>IllegalStateException</code> with clear message<br>
                        3. Prevents NPE and provides actionable error<br>
                        4. Guides developer to call <code>init()</code> method first
                    </div>
                </div>
            </div>

            <!-- Explanation -->
            <div class="explanation">
                <h4>ðŸ“ Why This Fix Works</h4>
                <ul>
                    <li><strong>Defensive Programming:</strong> Validates preconditions before proceeding</li>
                    <li><strong>Clear Error Messages:</strong> Tells developer exactly what went wrong</li>
                    <li><strong>Fail Fast:</strong> Catches the error at the source instead of cascading failures</li>
                    <li><strong>Easy to Debug:</strong> Stack trace points to exact issue and solution</li>
                </ul>
            </div>

            <!-- Actions -->
            <div class="actions-bar">
                <div style="display: flex; gap: 1rem;">
                    <a href="https://github.com/org/repo/blob/main/src/main/java/DDNStorage.java#L127" class="github-link" target="_blank">
                        ðŸ“‚ Open in GitHub (Line 127)
                    </a>
                    <a href="https://jenkins.example.com/job/12345" class="btn btn-analyze" target="_blank">
                        ðŸ”§ View in Jenkins
                    </a>
                </div>
                <button class="btn btn-primary" onclick="showFeedback()">
                    ðŸ’¬ Not Satisfied? Refine Analysis
                </button>
            </div>
        </div>
    </div>

    <script>
        function openComparison(buildId) {
            document.getElementById('comparisonModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('comparisonModal').classList.remove('active');
        }

        function showFeedback() {
            alert('ðŸ’¬ Feedback Modal\n\nYou can provide feedback like:\n\n"This is actually a config issue, not a code error. Check app.properties for missing storage.path"\n\nClaude will re-analyze with your context and provide updated before/after comparison.');
        }

        // Close on background click
        document.getElementById('comparisonModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });

            // Remove active from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');

            // Mark button as active
            event.target.classList.add('active');
        }

        // Open first comparison on load (demo) - commented out to show tabs first
        // setTimeout(() => {
        //     openComparison('12345');
        // }, 500);
    </script>
</body>
</html>
