<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Teams Notification Preview - DDN AI Test Failure Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .teams-container {
            max-width: 600px;
            width: 100%;
            background: #f3f2f1;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .teams-card {
            background: white;
            border-radius: 4px;
            border-left: 4px solid #6264A7;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-header {
            background: #6264A7;
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .card-header .icon {
            font-size: 2rem;
        }

        .card-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .card-body {
            padding: 1.5rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .status-error {
            background: #fde7e9;
            color: #c4314b;
        }

        .status-success {
            background: #dff6dd;
            color: #0b6a0b;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.75rem;
            color: #605e5c;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        .info-value {
            font-size: 0.9375rem;
            color: #323130;
            font-weight: 600;
        }

        .section {
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #323130;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-content {
            background: #faf9f8;
            padding: 1rem;
            border-radius: 4px;
            border-left: 3px solid #6264A7;
        }

        .error-message {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: #c4314b;
            background: #fde7e9;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .fix-recommendation {
            font-size: 0.9375rem;
            color: #323130;
            line-height: 1.6;
        }

        .code-block {
            background: #292929;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            margin-top: 0.75rem;
            line-height: 1.5;
        }

        .code-block .added {
            color: #4ec9b0;
        }

        .metadata {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #faf9f8;
            border-top: 1px solid #edebe9;
            font-size: 0.8125rem;
            color: #605e5c;
        }

        .metadata-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            background: #faf9f8;
            border-top: 1px solid #edebe9;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #6264A7;
            color: white;
        }

        .btn-primary:hover {
            background: #464775;
        }

        .btn-secondary {
            background: white;
            color: #323130;
            border: 1px solid #8a8886;
        }

        .btn-secondary:hover {
            background: #f3f2f1;
        }

        .confidence-bar {
            margin-top: 1rem;
        }

        .confidence-label {
            font-size: 0.8125rem;
            color: #605e5c;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #edebe9;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0078d4 0%, #00bcf2 100%);
            border-radius: 4px;
            transition: width 1s ease;
        }

        .github-files {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .github-file {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: white;
            border: 1px solid #edebe9;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .file-path {
            color: #323130;
            font-family: 'Courier New', monospace;
        }

        .file-line {
            color: #0078d4;
            font-weight: 600;
        }

        .variants {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-top: 3rem;
        }

        .variant-label {
            background: white;
            color: #6264A7;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì¢ Microsoft Teams Notification Preview</h1>
        <p>DDN AI Test Failure Analysis System</p>
    </div>

    <div class="variants">
        <!-- VARIANT 1: FAILURE DETECTED -->
        <div class="teams-container">
            <div class="variant-label">üî¥ Notification Type 1: Test Failure Detected (Auto-Trigger)</div>
            <div class="teams-card">
                <div class="card-header">
                    <span class="icon">üö®</span>
                    <div>
                        <h2>Test Failure Detected</h2>
                        <div style="font-size: 0.875rem; opacity: 0.9;">DDN-Smoke-Tests #12345</div>
                    </div>
                </div>

                <div class="card-body">
                    <span class="status-badge status-error">‚ùå FAILURE</span>

                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Build ID</div>
                            <div class="info-value">#12345</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Job Name</div>
                            <div class="info-value">DDN-Smoke-Tests</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Test Suite</div>
                            <div class="info-value">Health Check Suite</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Aging</div>
                            <div class="info-value" style="color: #c4314b;">7 days</div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>‚ö†Ô∏è</span>
                            Error Message
                        </div>
                        <div class="error-message">
java.lang.NullPointerException
    at com.ddn.storage.DDNStorage.saveDatabindFile(DDNStorage.java:127)
    at com.ddn.health.HealthCheck.verifyStorage(HealthCheck.java:89)
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>ü§ñ</span>
                            AI Analysis Status
                        </div>
                        <div class="section-content">
                            Analysis in progress using Claude AI + MCP...<br>
                            <strong>ETA: 15-20 seconds</strong>
                        </div>
                    </div>
                </div>

                <div class="metadata">
                    <div class="metadata-item">
                        <span>üïê</span>
                        <span>October 18, 2025 10:15 AM</span>
                    </div>
                    <div class="metadata-item">
                        <span>üèóÔ∏è</span>
                        <span>Branch: main</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <a href="#" class="btn btn-primary">
                        <span>üîß</span>
                        View in Jenkins
                    </a>
                    <a href="#" class="btn btn-secondary">
                        <span>üìä</span>
                        Open Dashboard
                    </a>
                </div>
            </div>
        </div>

        <!-- VARIANT 2: ANALYSIS COMPLETE -->
        <div class="teams-container">
            <div class="variant-label">‚úÖ Notification Type 2: AI Analysis Complete</div>
            <div class="teams-card">
                <div class="card-header">
                    <span class="icon">ü§ñ</span>
                    <div>
                        <h2>AI Analysis Complete</h2>
                        <div style="font-size: 0.875rem; opacity: 0.9;">DDN-Smoke-Tests #12345</div>
                    </div>
                </div>

                <div class="card-body">
                    <span class="status-badge" style="background: #d1f4ff; color: #0078d4;">ü§ñ CODE_ERROR</span>

                    <div class="confidence-bar">
                        <div class="confidence-label">
                            AI Confidence Score: <strong>92%</strong>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 92%;"></div>
                        </div>
                    </div>

                    <div class="section" style="margin-top: 1.5rem;">
                        <div class="section-title">
                            <span>üìù</span>
                            Root Cause
                        </div>
                        <div class="section-content">
                            <strong>NullPointerException at DDNStorage.java:127</strong><br><br>
                            The <code>storageConfig</code> object is accessed without null validation. When initialization fails to load configuration from <code>app.properties</code>, this causes a NullPointerException.
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>üí°</span>
                            Recommended Fix
                        </div>
                        <div class="section-content">
                            <div class="fix-recommendation">
                                1. Add null check before accessing <code>storageConfig.getPath()</code><br>
                                2. Throw <code>IllegalStateException</code> with clear error message<br>
                                3. Ensure configuration is loaded in <code>init()</code> method<br>
                                4. Add unit test to verify exception is thrown when config missing
                            </div>
                            <div class="code-block">
<span class="added">+ if (storageConfig == null) {</span>
<span class="added">+     throw new IllegalStateException(</span>
<span class="added">+         "Storage not initialized. Call init() first."</span>
<span class="added">+     );</span>
<span class="added">+ }</span>
  String path = storageConfig.getPath();
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>üìÇ</span>
                            Related Files
                        </div>
                        <div class="github-files">
                            <div class="github-file">
                                <span class="file-path">src/main/java/DDNStorage.java</span>
                                <span class="file-line">Line 127</span>
                            </div>
                            <div class="github-file">
                                <span class="file-path">src/main/resources/app.properties</span>
                                <span class="file-line">Line 45</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="metadata">
                    <div class="metadata-item">
                        <span>‚è±Ô∏è</span>
                        <span>Analysis Time: 14.3s</span>
                    </div>
                    <div class="metadata-item">
                        <span>üí∞</span>
                        <span>Cost: $0.08</span>
                    </div>
                    <div class="metadata-item">
                        <span>üîç</span>
                        <span>MCP Deep Analysis</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <a href="#" class="btn btn-primary">
                        <span>üëÅÔ∏è</span>
                        View Full Analysis
                    </a>
                    <a href="#" class="btn btn-secondary">
                        <span>üîó</span>
                        Open in GitHub
                    </a>
                    <a href="#" class="btn btn-secondary">
                        <span>üîß</span>
                        Jenkins Build
                    </a>
                </div>
            </div>
        </div>

        <!-- VARIANT 3: MANUAL TRIGGER -->
        <div class="teams-container">
            <div class="variant-label">üëÜ Notification Type 3: Manual Analysis Triggered</div>
            <div class="teams-card">
                <div class="card-header">
                    <span class="icon">üë§</span>
                    <div>
                        <h2>Manual Analysis Requested</h2>
                        <div style="font-size: 0.875rem; opacity: 0.9;">by john.doe@company.com</div>
                    </div>
                </div>

                <div class="card-body">
                    <span class="status-badge" style="background: #fff4ce; color: #8a6d3b;">‚è≥ IN PROGRESS</span>

                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Build ID</div>
                            <div class="info-value">#12346</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Triggered By</div>
                            <div class="info-value">John Doe</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source</div>
                            <div class="info-value">Dashboard</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Workflow</div>
                            <div class="info-value">Manual Trigger</div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>üîÑ</span>
                            Analysis Steps
                        </div>
                        <div class="section-content">
                            ‚úÖ Fetching build data from MongoDB<br>
                            ‚úÖ Classifying error type with LangGraph<br>
                            üîÑ Searching similar solutions (RAG)<br>
                            ‚è≥ Running Claude MCP analysis...<br>
                            ‚è≥ Generating code fix recommendations...<br>
                        </div>
                    </div>
                </div>

                <div class="metadata">
                    <div class="metadata-item">
                        <span>üïê</span>
                        <span>Started: 10:30 AM</span>
                    </div>
                    <div class="metadata-item">
                        <span>‚è±Ô∏è</span>
                        <span>ETA: 12 seconds remaining</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <a href="#" class="btn btn-secondary">
                        <span>üìä</span>
                        Watch Progress
                    </a>
                </div>
            </div>
        </div>

        <!-- VARIANT 4: REFINEMENT -->
        <div class="teams-container">
            <div class="variant-label">üí¨ Notification Type 4: Analysis Refined with User Feedback</div>
            <div class="teams-card">
                <div class="card-header">
                    <span class="icon">üîÑ</span>
                    <div>
                        <h2>Analysis Refined</h2>
                        <div style="font-size: 0.875rem; opacity: 0.9;">Based on user feedback</div>
                    </div>
                </div>

                <div class="card-body">
                    <span class="status-badge status-success">‚úÖ REFINED</span>

                    <div class="section">
                        <div class="section-title">
                            <span>üí¨</span>
                            User Feedback
                        </div>
                        <div class="section-content">
                            "This is actually a config issue, not a code error. Check app.properties for missing storage.path property."
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>üîÑ</span>
                            Changes Made
                        </div>
                        <div class="section-content">
                            <strong style="color: #c4314b;">Previous Category:</strong> CODE_ERROR<br>
                            <strong style="color: #0b6a0b;">New Category:</strong> CONFIG_ERROR<br><br>
                            <strong style="color: #0078d4;">Confidence Improved:</strong> 92% ‚Üí 95% (+3%)<br><br>
                            <strong>Refinement Version:</strong> 2
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>üìù</span>
                            Updated Root Cause
                        </div>
                        <div class="section-content">
                            <strong>Missing storage.path in app.properties</strong><br><br>
                            The configuration file is missing the <code>storage.path</code> property. The code expects this value to be set during initialization. When it's missing, <code>storageConfig.getPath()</code> returns null, causing NullPointerException.
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">
                            <span>üí°</span>
                            Updated Fix
                        </div>
                        <div class="section-content">
                            <strong>Add storage.path to app.properties:</strong>
                            <div class="code-block">
<span style="color: #6a9955;"># app.properties</span>
<span class="added">+ storage.path=/var/lib/ddn/storage</span>
<span class="added">+ storage.create_if_missing=true</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="metadata">
                    <div class="metadata-item">
                        <span>üë§</span>
                        <span>Refined by: john.doe@company.com</span>
                    </div>
                    <div class="metadata-item">
                        <span>‚è±Ô∏è</span>
                        <span>Re-analysis Time: 18.5s</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <a href="#" class="btn btn-primary">
                        <span>üìú</span>
                        View History
                    </a>
                    <a href="#" class="btn btn-secondary">
                        <span>üëÅÔ∏è</span>
                        Compare Versions
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div style="text-align: center; color: white; margin-top: 3rem; opacity: 0.9;">
        <p style="font-size: 0.875rem;">These notifications are sent via n8n HTTP Request node to Microsoft Teams Webhook</p>
        <p style="font-size: 0.875rem; margin-top: 0.5rem;">Configure webhook URL in n8n workflow or environment variables</p>
    </div>
</body>
</html>
